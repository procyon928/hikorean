<!-- 상단 내비게이션바 (views/partials/navbar.ejs) -->
<nav class="navbar" style="background-color: #254B7A;"> 
  <div class="d-flex justify-content-between align-items-center w-100">
      <div class="nav-item text-start w-25 ms-3">
          <% if (!user) { %>
              <a href="/login" class="nav-link p-0 me-2"> <!-- /login -->
                  <i class="bi bi-person-circle" style="font-size: 22px; color: white; opacity: 0.75;"></i>
              </a>
          <% } else { %>
              <a href="/account" class="nav-link p-0 me-2">
                  <i class="bi bi-gear-fill" style="font-size: 22px; color: white; opacity: 0.75;"></i>
              </a>
          <% } %>
      </div>
      <div class="nav-item text-center d-flex justify-content-center">
          <a class="navbar-brand d-flex align-items-center m-0" href="/" style="font-size: 18px;">
            <img src="/img/logo-white.png" alt="" width="22" height="22" class="d-inline-block align-text-top"> 
            <span class="ms-2 text-white">HiKorean<span class="text-warning small fw-bold"><sup> beta</sup></span></span>
          </a>
      </div>
      <div class="nav-item text-end w-25 d-flex me-3 justify-content-end align-items-center position-relative"> 
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle p-0" href="#" id="navbarScrollingDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: white; opacity: 0.75;">
              <i class="bi bi-translate" style="font-size: 22px; color: white;"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarScrollingDropdown" style="position: absolute; z-index: 1000; min-width: auto;">
                <li><a class="dropdown-item" href="javascript:void(0);" onclick="changeLanguage('ko')">한국어</a></li>
                <li><a class="dropdown-item" href="javascript:void(0);" onclick="changeLanguage('en')">English</a></li>
                <li><a class="dropdown-item" href="javascript:void(0);" onclick="changeLanguage('sc')">简体中文</a></li>
                <li><a class="dropdown-item" href="javascript:void(0);" onclick="changeLanguage('tc')">繁體中文</a></li>
                <li><a class="dropdown-item" href="javascript:void(0);" onclick="changeLanguage('jp')">日本語</a></li>
                <li><a class="dropdown-item" href="javascript:void(0);" onclick="changeLanguage('vi')">Tiếng Việt</a></li>
            </ul>
          </li>
        </ul>
    </div>
</div>
</nav>

<script>
  function changeLanguage(lang) {
    const currentUrl = window.location.href;
    const baseUrl = currentUrl.split('?')[0];
    const params = new URLSearchParams(window.location.search);
    params.set('lang', lang); // 언어 쿼리 업데이트
  
    // 모든 링크에 쿼리 파라미터 추가
    document.querySelectorAll('a').forEach(link => {
      if (!link.href || link.href === 'javascript:void(0);') {
        // 유효하지 않은 링크는 건너뜁니다.
        console.warn('Skipping invalid link:', link.href);
        return;
      }
  
      let linkUrl;
      try {
        linkUrl = new URL(link.href); // URL 객체 생성
      } catch (e) {
        console.error('Invalid URL:', link.href);
        return; // 유효하지 않은 URL인 경우 건너뜁니다.
      }
  
      linkUrl.searchParams.set('lang', lang); // 언어 쿼리 추가
      link.href = linkUrl.toString(); // 수정된 URL로 링크를 업데이트
    });
  
    window.location.href = baseUrl + '?' + params.toString(); // 새로운 URL로 이동
  }

  // 페이지가 로드될 때 현재 언어 확인
  window.addEventListener('load', function() {
      const params = new URLSearchParams(window.location.search);
      const lang = params.get('lang') || 'ko'; // 기본값을 'ko'로 설정

      const translateIcon = document.querySelector('.bi-translate');
      console.log(translateIcon);

      // 현재 언어가 'ko'일 경우 아이콘에 애니메이션 클래스 추가
      if (lang === 'ko') {
          translateIcon.classList.add('blink');
          console.log('blink class added');

          // 3초 후에 애니메이션 클래스 제거
          setTimeout(() => {
              translateIcon.classList.remove('blink');
              console.log('blink class removed');
          }, 3000);
      }
  });
  </script>
  
<script>
  (function(){
    var w=window;
    if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}
    var ch=function(){ch.c(arguments);};
    ch.q=[];
    ch.c=function(args){ch.q.push(args);};
    w.ChannelIO=ch;
    function l(){
      if(w.ChannelIOInitialized){return;}
      w.ChannelIOInitialized=true;
      var s=document.createElement("script");
      s.type="text/javascript";
      s.async=true;
      s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";
      var x=document.getElementsByTagName("script")[0];
      if(x.parentNode){x.parentNode.insertBefore(s,x);
      }
    }
    if(document.readyState==="complete"){l();
    }else{
      w.addEventListener("DOMContentLoaded",l);
      w.addEventListener("load",l);
    }
  })();
</script>

<script>
  ChannelIO('boot', {
    "pluginKey": "2a26c3a5-c895-483a-bac2-8f63946638ed" // 실제 플러그인 키로 교체
  });
</script>