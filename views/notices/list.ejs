<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆë‚´ë¬¸ ëª©ë¡</title>
    <meta name="theme-color" content="#254B7A"> <!-- Android Chrome -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <!-- iOS Safari -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css"> <!-- CSS íŒŒì¼ ê²½ë¡œ -->
</head>
<body>
    <%- include('../partials/navbar') %> 
    <%- include('../partials/bottom-navbar') %>
    
    <div class="container-fluid p-0" style="max-width: 960px; margin-bottom: 100px;">
        <div class="content-wrapper p-3">
    <h1 class="mt-4 text-center">ì•ˆë‚´ë¬¸ ëª©ë¡</h1>
    <div class="mb-4 text-end">
      <a href="/notices/new" class="btn btn-primary">ìƒˆ ì•ˆë‚´ë¬¸ ì‘ì„±</a>
    </div>
    <div class="card">
      <div class="card-body">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>ì œëª©</th>
              <th>ì‘ì„±ì¼</th>
              <th>ìˆ˜ì •ì¼</th>
              <th>ì¤‘êµ­ì–´ ê°„ì²´</th>
              <th>ì¤‘êµ­ì–´ ë²ˆì²´</th>
              <th>ì¼ë³¸ì–´</th>
              <th>ì˜ì–´</th>
              <th>ë² íŠ¸ë‚¨ì–´</th>
              <th>ìˆ˜ì • ë° ì‚­ì œ</th>
            </tr>
          </thead>
          <tbody>
            <% 
            const getStatus = (finalSavedAt, updatedAt) => {
                if (!finalSavedAt) return 'ğŸ”´'; // ì¡°ê±´ 1: finalSavedAtì´ ë¹ˆê°’
                if (updatedAt && finalSavedAt < updatedAt) return 'ğŸŸ¡'; // ì¡°ê±´ 2: finalSavedAt < updatedAt
                return 'ğŸŸ¢'; // ì¡°ê±´ 3: finalSavedAt > updatedAt ë˜ëŠ” updatedAtì´ ë¹ˆê°’
            };
            %>
            <% notices.forEach(notice => { %>
              <tr>
                <td>
                  <a href="/notices/translate/<%= notice._id %>"><%= notice.title %></a>
                  <a href="/notices/<%= notice.shortId %>?lang=ko" class="link-secondary">ğŸ”—</a>
                </td>
                <td><%= notice.createdAt.toLocaleDateString() %><br><%= notice.createdBy ? notice.createdBy : '' %></td>
                <td><%= notice.updatedAt ? notice.updatedAt.toLocaleDateString() : '' %><br><%= notice.updatedBy ? notice.updatedBy : '' %></td>
                <td>
                    <a href="/notices/<%= notice.shortId %>?lang=sc" class="link-secondary"><%= getStatus(notice.translations.sc?.finalSavedAt, notice.updatedAt) %></a>
                    <a href="#" onclick="copyToClipboard('<%= notice.translations.sc?.final.join(' ') %>')">ğŸ“‹</a><br>
                    <%= notice.translations.sc?.finalSavedBy ? notice.translations.sc.finalSavedBy : '' %>
                </td>
                <td>
                    <a href="/notices/<%= notice.shortId %>?lang=tc" class="link-secondary"><%= getStatus(notice.translations.tc?.finalSavedAt, notice.updatedAt) %></a>
                    <a href="#" onclick="copyToClipboard('<%= notice.translations.tc?.final.join(' ') %>')">ğŸ“‹</a><br>
                    <%= notice.translations.tc?.finalSavedBy ? notice.translations.tc.finalSavedBy : '' %>
                </td>
                <td>
                    <a href="/notices/<%= notice.shortId %>?lang=jp" class="link-secondary"><%= getStatus(notice.translations.jp?.finalSavedAt, notice.updatedAt) %></a>
                    <a href="#" onclick="copyToClipboard('<%= notice.translations.jp?.final.join(' ') %>')">ğŸ“‹</a><br>
                    <%= notice.translations.jp?.finalSavedBy ? notice.translations.jp.finalSavedBy : '' %>
                </td>
                <td>
                    <a href="/notices/<%= notice.shortId %>?lang=en" class="link-secondary"><%= getStatus(notice.translations.en?.finalSavedAt, notice.updatedAt) %></a>
                    <a href="#" onclick="copyToClipboard('<%= notice.translations.en?.final.join(' ') %>')">ğŸ“‹</a><br>
                    <%= notice.translations.en?.finalSavedBy ? notice.translations.en.finalSavedBy : '' %>
                </td>
                <td>
                    <a href="/notices/<%= notice.shortId %>?lang=vi" class="link-secondary"><%= getStatus(notice.translations.vi?.finalSavedAt, notice.updatedAt) %></a>
                    <a href="#" onclick="copyToClipboard('<%= notice.translations.vi?.final.join(' ') %>')">ğŸ“‹</a><br>
                    <%= notice.translations.vi?.finalSavedBy ? notice.translations.vi.finalSavedBy : '' %>
                </td>
                <td>
                    <a href="/notices/edit/<%= notice._id %>" class="btn btn-warning btn-sm">ìˆ˜ì •</a>
                    <form action="/notices/delete/<%= notice._id %>" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm">ì‚­ì œ</button>
                    </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    document.documentElement.dataset.lang = '<%= lang %>';
</script>
<script src="/js/lang.js"></script> 

  <script>
    function copyToClipboard(text) {
        if (text.trim().length > 0) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
    }
  </script>
</body>
</html>
