<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>번역기</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1><%= notice.title %> 번역</h1>
    <form action="/notices/translate/<%= notice._id %>" method="POST">
        <label for="targetLang">목표 언어 선택:</label>
        <select id="targetLang" name="targetLang" required>
          <option value="" disabled selected>언어 선택</option>
          <% const lang = typeof targetLang !== 'undefined' ? targetLang : ''; %>
          <option value="en" <%= targetLang === 'en' ? 'selected' : '' %>>영어</option>
          <option value="jp" <%= targetLang === 'jp' ? 'selected' : '' %>>일본어</option>
          <option value="tc" <%= targetLang === 'tc' ? 'selected' : '' %>>중국어(번체)</option>
          <option value="sc" <%= targetLang === 'sc' ? 'selected' : '' %>>중국어(간체)</option>
          <option value="vi" <%= targetLang === 'vi' ? 'selected' : '' %>>베트남어</option>
        </select>
        <button type="submit">번역</button>
    </form>
    
    <% if (lines && lines.length > 0) { %>
      <form action="/notices/translate/save/<%= notice._id %>" method="POST">
          <input type="hidden" name="title" value="<%= notice.title %>">
          <input type="hidden" name="content" value="<%= notice.content %>">
          <input type="hidden" name="lang" value="<%= targetLang %>">
          <% for (let i = 0; i < lines.length; i++) { %>
              <div class="translation-pair">
                  <div class="original">
                    <img src="/korean.png" alt="한국어 원문" style="width: 20px; height: 20px;"> <%= lines[i] %>
                  </div>
                  <div class="google-translation" onclick="setFinalTranslation(<%= i %>, '<%= googleTranslations[i] %>', event)">
                    <img src="/google.png" alt="구글 번역" style="width: 20px; height: 20px;"> <%= googleTranslations[i] %>
                </div>
                <div class="microsoft-translation" onclick="setFinalTranslation(<%= i %>, '<%= microsoftTranslations[i] %>', event)">
                    <img src="/microsoft.png" alt="마이크로소프트 번역" style="width: 20px; height: 20px;"> <%= microsoftTranslations[i] %>
                </div>
                  <div class="final-translation">
                    <label for="finalTranslation<%= i %>">최종 번역:</label>
                    <textarea id="finalTranslation<%= i %>" name="finalTranslations[<%= i %>]" required style="width: 100%; box-sizing: border-box;"><%= finalTranslations[i] || '' %></textarea>

                  </div>                
              </div>
              <hr>
          <% } %>
          <button type="submit">저장</button>
      </form>
    <% } else { %>
      <p>번역할 내용이 없습니다.</p>
    <% } %>

    <script>
function setFinalTranslation(index, translation, event) {
    const textarea = document.getElementById(`finalTranslation${index}`);
    textarea.value = translation; // 번역 내용을 textarea에 설정

    // 모든 이미지에서 선택된 클래스 제거
    document.querySelectorAll('.google-translation, .microsoft-translation').forEach(img => {
        img.classList.remove('selected');
    });

    // 클릭한 이미지에 선택된 클래스 추가
    const selectedImg = event.currentTarget; // 클릭한 요소
    selectedImg.classList.add('selected');
}


      document.addEventListener("DOMContentLoaded", function() {
          const translationPairs = document.querySelectorAll('.translation-pair');
  
          translationPairs.forEach(pair => {
              const originalHeight = pair.querySelector('.original').offsetHeight;
              const googleHeight = pair.querySelector('.google-translation').offsetHeight;
              const microsoftHeight = pair.querySelector('.microsoft-translation').offsetHeight;
  
              // 가장 높은 height 값 찾기
              const maxHeight = Math.max(originalHeight, googleHeight, microsoftHeight);
  
              // textarea의 높이를 설정
              const textarea = pair.querySelector('.final-translation textarea');
              textarea.style.height = maxHeight + 'px';
          });
      });
  </script>
  
</body>
</html>
