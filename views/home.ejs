<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiKorean beta</title>
    <meta name="theme-color" content="#254B7A"> <!-- Android Chrome -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <!-- iOS Safari -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="/css/calendar.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: rgba(0, 0, 0, 0.03); /* 검은색 배경과 2% 투명도 */
        }
        .calendar-table {
            border-collapse: collapse;
            max-width: 100%;
            width: 100%;
            background-color: transparent;
        }
        .calendar-table th, .calendar-table td {
            text-align: center;
            padding: 12px 10px; /* 기존 패딩 유지 */
            vertical-align: middle;
            border: none; /* none으로 하면 테두리 없음 1px solid #dee2e6 */
            position: relative; /* 상대 위치 설정 */
        }
        .calendar-table th {
            font-weight: bold;
        }
        .scrollable-container {
            max-height: 150px; /* 원하는 최대 높이 설정 */
            overflow-y: scroll; /* 스크롤 가능하게 설정 */
            position: relative; /* 상대 위치 설정 */
            margin-top: -1px; /* 경계선이 보이지 않도록 조정 */
        }

        /* 스크롤바 숨기기 */
        .scrollable-container::-webkit-scrollbar {
            display: none; /* 스크롤바 숨기기 */
        }
        .calendar-table th {
            position: sticky; /* 고정 */
            top: 0; /* 상단에 고정 */
            background-color: white; /* 배경색 설정 (필요 시) */
            z-index: 10; /* z-index 설정 (필요 시) */
        }
        .schedule-info {
            display: none; /* 기본적으로 숨김 */
            margin-top: 5px; /* 위쪽 여백 */
            text-align: left; /* 왼쪽 정렬 */
            grid-column: span 7; /* 7개 열을 차지 */
            width: 100%; /* 전체 너비 차지 */
        }
        .swiper-container {
            width: 100%; /* 전체 너비 차지 */
            max-width: 100vw; /* 뷰포트 너비를 초과하지 않도록 설정 */
            overflow: hidden; /* 넘치는 내용 숨기기 */
            position: relative;
            height: auto;
            padding-top: 22px;
        }
        .swiper-slide img {
            display: block;
            width: 100%; /* 이미지의 너비를 100%로 설정 */
            height: auto; /* 비율 유지 */
            object-fit: cover; /* 비율 유지하며 크기를 맞춤 */
        }
        .swiper-button-next, .swiper-button-prev {
            color: #ffffff; /* 버튼 색상 (필요에 따라 조정) */
            width: 40px; /* 버튼 너비 */
            height: 40px; /* 버튼 높이 */
            opacity: 0.7;
        }
        .swiper-pagination {
            top: -7px !important; /* 슬라이드 위쪽에 위치 */
            left: 50%; /* 중앙 배치 */
            transform: translateX(-50%, 0); /* 중앙 정렬을 위해 이동 */
            z-index: 10; /* 다른 요소 위에 표시 */
        }
        .swiper-pagination .swiper-pagination-bullet {
            background-color: #254B7A; /* 기본 배경색 */
            opacity: 0.2; /* 기본 투명도 */
            width: 10px; /* 너비 */
            height: 10px; /* 높이 */
            margin: 0 4px; /* 간격 조정 */
            border-radius: 50%; /* 원형으로 만들기 */
        }
        .swiper-pagination .swiper-pagination-bullet-active {
            background-color: #254B7A; /* 활성화된 버튼 색상 */
            opacity: 1; /* 활성화된 버튼의 투명도 */
        }
    </style>
</head>
<body>
    <%- include('partials/navbar') %> 
    <%- include('partials/bottom-navbar') %>
    <div class="container-fluid p-0" style="max-width: 960px; margin-bottom: 100px;">
        <div class="content-box text-center p-2 position-relative" style="background-color: #91AD09;">
            <span class="small text-decoration-underline">
              <a href="/notices/<%= latestNotice._id %>" class="text-white">
                  <%= latestNotice.title %>
              </a>
            </span>
            <i class="bi bi-x position-absolute top-0 end-0 m-2" style="color: white; cursor: pointer;" aria-label="Close"></i>
        </div>
        
        <div class="my-3">
          <div class="swiper-container">
              <div class="swiper-wrapper">
                  <div class="swiper-slide">
                      <img src="/img/notice1.png" alt="Image 1" />
                  </div>
                  <div class="swiper-slide">
                      <img src="/img/notice2.png" alt="Image 2" />
                  </div>
                  <div class="swiper-slide">
                      <img src="/img/notice3.png" alt="Image 3" />
                  </div>
                  <!-- 더 많은 슬라이드 추가 가능 -->
              </div>
              <!-- 추가 내비게이션 버튼 (선택 사항) -->
              <div class="swiper-button-next"></div>
              <div class="swiper-button-prev"></div>
              <!-- 추가 페이지네이션 (선택 사항) -->
              <div class="swiper-pagination"></div>
          </div>
        </div>

        <div class="row my-3 mx-0">
            <div class="col-12 d-flex justify-content-center p-0">
                <a class="text-body text-decoration-none text-center opacity-75 p-0 mx-1" href="https://sites.google.com/hongik.ac.kr/guidebook/%ED%95%9C%EA%B5%AD%EC%96%B4/1-%ED%96%89%EC%A0%95%EC%97%85%EB%AC%B4?authuser=0" style="width: 20%;">
                    <img src="/img/school.png" alt="교육원 정보" style="width: 22px; height: 22px;">
                    <div class="small pt-1 lh-sm" style="font-size: 0.8rem;"><%= texts.home.instituteInfo[lang] %></div>
                </a>
                <a class="text-body text-decoration-none text-center opacity-75 p-0 mx-1" href="https://koreanle.hongik.ac.kr:4433/new/brochure/money_confirm.php?sMenu=kor47" style="width: 20%;">
                    <img src="/img/myinfo.png" alt="교육원 정보" style="width: 22px; height: 22px;">
                    <div class="small pt-1 lh-sm" style="font-size: 0.8rem;"><%= texts.home.myinfoPage[lang] %></div>
                </a>
                <a class="text-body text-decoration-none text-center opacity-75 p-0 mx-1" href="https://koreanle.hongik.ac.kr:4433/new/education/list.php?sMenu=kor24&db_code=edudata" style="width: 20%;">
                  <img src="/img/download.png" alt="양식 다운로드" style="width: 22px; height: 22px;">
                    <div class="small pt-1 lh-sm" style="font-size: 0.8rem;"><%= texts.home.forms[lang] %></div>
                </a>
                <a class="text-body text-decoration-none text-center opacity-75 p-0 mx-1" href="/surveys/6704f018b6965b1dae20083a/respond?lang=ko" style="width: 20%;">
                    <img src="/img/printer.png" alt="증명서 신청" style="width: 22px; height: 22px;">
                    <div class="small pt-1 lh-sm" style="font-size: 0.8rem;"><%= texts.home.certificate[lang] %></div>
                </a>
            </div>
        </div>

        <div class="row my-3 mx-0">
            <div class="col-12">
                <div class="table-responsive rounded-3 border bg-white shadow-sm p-2">
                    <div class="scrollable-container">
                        <table class="calendar-table">
                            <thead>
                                <tr style="height: 40px;">
                                    <th class="p-1 small"> </th>
                                    <th class="p-0 pt-2 small align-top"><%= texts.home.monday[lang] %></th>
                                    <th class="p-0 pt-2 small align-top"><%= texts.home.tuesday[lang] %></th>
                                    <th class="p-0 pt-2 small align-top"><%= texts.home.wednesday[lang] %></th>
                                    <th class="p-0 pt-2 small align-top"><%= texts.home.thursday[lang] %></th>
                                    <th class="p-0 pt-2 small align-top"><%= texts.home.friday[lang] %></th>
                                    <th class="p-0 pt-2 small align-top text-body-tertiary"><%= texts.home.saturday[lang] %></th>
                                    <th class="p-0 pt-2 small align-top text-body-tertiary"><%= texts.home.sunday[lang] %></th>
                                </tr>
                            </thead>
                            <tbody>
                                <% 
                                    const scheduleDates = schedules.map(schedule => {
                                        const start = new Date(schedule.startDate);
                                        const end = schedule.endDate ? new Date(schedule.endDate) : start;
                                        const dates = [];
                                        
                                        // startDate와 endDate 범위 사이의 날짜를 배열에 추가
                                        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                                            dates.push(new Date(d)); // 새로운 날짜 객체 생성
                                        }
                                        return dates;
                                    }).flat(); // 모든 날짜를 하나의 배열로 평탄화
                                %>
                                <% 
                                const startDate = new Date('2024-09-02');
                                const weeks = 13; // 총 13주
                                for (let i = 0; i < weeks; i++) {
                                    let weekDays = [];
                                    for (let j = 0; j < 7; j++) {
                                        const currentDate = new Date(startDate);
                                        currentDate.setDate(startDate.getDate() + (i * 7) + j);
                                        weekDays.push(currentDate);
                                    }
                                %>
                                <tr style="height: 40px;">
                                    <td class="text-primary p-1 align-top small">
                                        <%= (i + 1) <= 10 ? (i + 1) : '' %>
                                    </td> <!-- 주차 수 추가 -->
                                <% weekDays.forEach((day) => { %>
                                  <td class="p-1 small align-top 
                                      <%= (holidays.some(holiday => holiday.date === day.toISOString().split('T')[0]) ? 'text-danger' : '') || 
                                      (day.getDay() === 6 || day.getDay() === 0 ? 'text-body-tertiary' : '') %>">
                                  <div style="<%= day.toDateString() === new Date(todayKST).toDateString() ? 'font-weight: bold;' : '' %>">
                                        <%= day.getDate() %>
                                        <% if (scheduleDates.some(date => date.toDateString() === day.toDateString())) { %>
                                            <span class="schedule-dot text-danger" style="font-size: 0.5em; display: block; margin-top: 0px; cursor: pointer;">&#9679;</span> <!-- 빨간 점 표시 -->
                                        <% } %>
                                    </div>
                                    <div class="schedule-info" style="display: none; margin-top: 5px; text-align: left; grid-column: span 7; width: 100%;"></div> <!-- 일정 정보 표시용 div -->
                                </td>
                                <% }); %>
                                </tr>
                                <% } %>
                            </tbody>                          
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row my-3 mx-0">
            <div class="col-12">
                <div class="table-responsive rounded-3 border bg-white shadow-sm p-3">
                  <i class="bi bi-bookmark-star-fill text-danger"></i><p class="fw-bold ms-1 mb-2 d-inline-block"><%= texts.home.announcements[lang] %></p>
                    <p class="small mb-1"><i class="bi bi-star-fill text-warning"> </i><strong>[학사]</strong> 비자 연장 안내</p>
                    <p class="small mb-1"><strong>[학사]</strong> 유학생 보험 증서 다운로드 안내</p>
                    <p class="small mb-1"><strong>[문화]</strong> 한국 친구와 함께 한강에서 치맥을!</p>
                </div>
            </div>
        </div>

        
        <div class="row my-3 mx-0">
            <div class="col-12">
                <div class="table-responsive rounded-3 border bg-white shadow-sm p-3">
                    <i class="bi bi-pen-fill text-info-emphasis"></i><p class="fw-bold ms-1 mb-2 d-inline-block"><%= texts.home.latestPosts[lang] %></p>
                      <p class="small mb-1"><strong>[자유]</strong> 같이 밥 먹을 사람을 찾습니다.</p>
                      <p class="small mb-1"><strong>[한국어질문]</strong> 이 문법이 뭐예요?</p>
                      <p class="small mb-1"><strong>[문화]</strong> 한국 친구와 함께 한강에서 치맥을!</p>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.documentElement.dataset.lang = '<%= lang %>';
    </script>
    <script src="/js/lang.js"></script> 
    <script>
    const todayKST = new Date("<%= todayKST.toISOString() %>");

    document.addEventListener('DOMContentLoaded', function() {
        const scheduleDots = document.querySelectorAll('.schedule-dot');

        // 오늘 날짜 기준으로 스크롤 이동
        setTimeout(() => {
            const todayDay = todayKST.getDate(); // 서버에서 전달된 todayKST 사용
            const todayMonth = todayKST.getMonth();
            const todayYear = todayKST.getFullYear(); 

            const tableRows = document.querySelectorAll('.calendar-table tbody tr');
            let targetRow = null;

            tableRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach(cell => {
                    const cellDate = new Date(todayYear, todayMonth, cell.firstChild.textContent);
                    if (cellDate.toDateString() === todayKST.toDateString()) {
                        targetRow = row; // 오늘 날짜가 포함된 행 찾기
                    }
                });
            });

            // 오늘 날짜가 포함된 행으로 스크롤 이동
            if (targetRow) {
                const scrollableContainer = document.querySelector('.scrollable-container');
                const targetScrollTop = targetRow.offsetTop - scrollableContainer.offsetTop;

                // 주차 계산
                const weekNumber = Math.floor((targetRow.rowIndex) / 1) + 1; // 1주차부터 시작
                const offset = (weekNumber - 1) * 40; // 각 주의 높이를 40px로 설정

                // 스크롤 위치 조정 (부드러운 애니메이션)
                scrollableContainer.scrollTo({
                    top: offset,
                    behavior: 'smooth' // 부드러운 스크롤 애니메이션
                });
            } else {
                console.log("오늘 날짜가 포함된 행을 찾지 못했습니다."); // 행을 찾지 못했을 때 로그
            }
        }, 0); // 즉시 실행

        scheduleDots.forEach(dot => {
            dot.addEventListener('click', function() {
                const scheduleInfoDiv = this.closest('td').querySelector('.schedule-info');
                const dayElement = this.parentElement.firstChild; // 날짜 가져오기
                const dayContent = dayElement.textContent; // 날짜 텍스트 가져오기
                const currentYear = new Date().getFullYear(); // 현재 연도 가져오기
                const date = new Date(`${currentYear}-${new Date().getMonth() + 1}-${dayContent}`); // 날짜 객체 생성

                // AJAX 요청을 통해 해당 날짜의 일정을 가져오도록 수정
                fetch(`/schedules?date=${date.toISOString().split('T')[0]}`)
                    .then(response => response.json())
                    .then(data => {
                        scheduleInfoDiv.innerHTML = ''; // 기존 내용 초기화
                        if (data.length > 0) {
                            data.forEach(schedule => {
                                scheduleInfoDiv.innerHTML += `
                                    <div>
                                        <strong>제목:</strong> ${schedule.title}<br>
                                        <strong>유형:</strong> ${schedule.category}<br>
                                        <strong>시작:</strong> ${new Date(schedule.startDate).toLocaleString()}<br>
                                        <strong>종료:</strong> ${schedule.endDate ? new Date(schedule.endDate).toLocaleString() : '없음'}<br>
                                        <strong>설명:</strong> ${schedule.description}<br>
                                        <strong>링크:</strong> <a href="${schedule.link}" target="_blank">${schedule.link}</a><br>
                                        <hr>
                                    </div>
                                `;
                            });
                        } else {
                            scheduleInfoDiv.innerHTML = '<div>일정이 없습니다.</div>';
                        }
                        // 토글
                        scheduleInfoDiv.style.display = scheduleInfoDiv.style.display === 'none' ? 'block' : 'none';
                    });
            });
        });
    });

    // Swiper 초기화
    const swiper = new Swiper('.swiper-container', {
        loop: true, // 루프 모드 활성화
        autoplay: {
            delay: 5000, // 자동 재생 시간 (밀리초)
            disableOnInteraction: true, // 사용자 상호작용 시 자동 재생 유지
        },
        pagination: {
            el: '.swiper-pagination',
            clickable: true, // 클릭 가능
        },
        navigation: {
            nextEl: '.swiper-button-next', // 다음 버튼
            prevEl: '.swiper-button-prev', // 이전 버튼
        },
    });

    // 버튼 클릭 시 콘텐츠 박스 숨기기
    document.querySelector('.bi-x').addEventListener('click', function() {
        document.querySelector('.content-box').style.display = 'none';
    });
    </script>
</body>
</html>
